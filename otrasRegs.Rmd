
```{r carga}
library(foreign)
archivo="provinciasPeru.dbf"
perudat=read.dbf(archivo,as.is = T)
names(perudat)
```


```{r crea_recodifica}
niveles=c('muy baja','baja','media',"alta",'muy alta')

perudat$grupIDH=cut(perudat$IDH,
                    breaks = length(niveles),
                    labels = niveles,
                    ordered_result = T)

toPlot=table(perudat$grupIDH)
barplot(toPlot,
        xlab = 'IDH niveles',
        ylab = 'Conteo de Provincias')
```

```{r subset}
# podemos querer explicar el nivel de IDH
# 1-segun cada componente del IDE menos educacion
# 2-estar en la costa

regvars=perudat[,c(40,15,16,18,19,21)]
names(regvars)
```


```{r exploraCAT_uni}
regvars$costa <- factor(regvars$costa)
table(regvars$costa)
```

```{r}
library("oglmx")
model2=ologit.reg(grupIDH ~ .,
                  data = regvars)
summary(model2)
```

```{r}
(model2m=margins.oglmx(model2,ascontinuous = TRUE))
```





```{r carga}
library(foreign)
archivo="provinciasPeru.dbf"
perudat=read.dbf(archivo,as.is = T)
names(perudat)
```

```{r}
# como se comporta la mortalidad?
hist(perudat$mortalidad)
```

```{r}
#explorando
summary(perudat$mortalidad)
```
```{r}
# es un porcentaje, pasemoslos (0,1)
perudat$mortalidad=perudat$mortalidad/100
```

```{r}
#replanteemos regresión
#esta acotada!!!

library(betareg)
#VD:mortalidad
#VIs:desnutrici, percapitaf, salud, saneamient, analfa
#VCs:población
betaData=perudat[,c('mortalidad','desnutrici', 'percapitaf', 'salud', 'saneamient', 'analfa','pob')]
modelo=betareg(mortalidad~desnutrici+percapitaf+salud+saneamient+analfa,
            data=betaData)
summary(modelo)
```

```{r model1_interpre_margins}
# interpracion usando marginal effects:
library(margins)

(modeloM = margins(modelo))

```

```{r}
summary(modeloM)
```

Tarea: Hacer grafico de intervalo de confianza de cada VarIndep (factor) usando ggplot.

#####


PLAN:

* Var Dependiente: MATEMATICA (MATH)
* Var Independiente: RDG + WRTG


```{r}
# desde google

link="https://docs.google.com/spreadsheets/d/e/2PACX-1vTcFY_f_k94wuMUL8ISrklSmjlbYgnPeEVdGApFI0Y39OQB8IrHvv1bmD6E0u9uYo06Bpl5llns-BLR/pub?gid=1282421390&single=true&output=csv"
```

```{r}
# leyendo

allData=read.csv(link)
```

```{r}
str(allData)
```



## Regresión: Hipótesis Asimétrica:

El nivel de RDG y WRTG afecta al desempeño en matemática

```{r}
modelo2=lm(MATH~RDG+WRTG, data = allData)

summary(modelo2)
```



* Visualizando predictor:

```{r}
library(sjPlot)
library(snakecase)

plot_models(modelo2,colors = 'blue',
            vline.color = "red",
            axis.lim = c(-1,1))
```




* Qué valor uso para comparar este modelo?
```{r}
# si hay mas de una variable, usar: (sino usar el anterior)
summary(modelo2)$adj.r.squared
```

Representación:

```{r}
library(semPlot)
semPaths(modelo2,whatLabels  = 'par')
```

Si añado SES como un predictor más, hay diferencia?
```{r}
modelo3=lm(MATH~RDG+WRTG + factor(SES), data = allData)

summary(modelo3)
```
```{r}
plot_model(modelo3,colors = 'blue',
            vline.color = "red",
            axis.lim = c(-1,5))
```

```{r}
semPaths(modelo3,
         whatLabels = 'par',
         edge.label.cex = 2)
```

```{r}
semPaths(modelo3,what = 'std',
         whatLabels = 'par',
         edge.label.cex = 2)
```

El R-cuadrado ajustado ha subido... me quedo con el nuevo predictor?
```{r}
anova(modelo2,modelo3)
```

o...
```{r}
anova(modelo2,modelo3)$`Pr(>F)`[2]<0.05
```

Es decir, añadir ese predictor sí es relevante. Se debe quedar.

```{r}
library(lavaan)

# 1. Especificando modelo

modelo4<-'
MATH ~ RDG + WRTG
WRTG ~ MOT
RDG ~ SES + MOT
'

# 2. Calculos

modelo4_Resultado<-sem(modelo4, data=allData, fixed.x=FALSE)

# 3. Resultados

summary(modelo4_Resultado, standardized=TRUE)
```

```{r}
semPaths(modelo4_Resultado ,layout='tree2',whatLabels = 'std')

```


