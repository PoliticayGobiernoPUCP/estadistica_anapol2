<center><img src="https://github.com/PoliticayGobiernoPUCP/estadistica_anapol2/raw/master/PICS/LOGO_PUCP.png" width="500"></center>

<center> <header><h1>ESTADISTICA PARA EL ANALISIS POLITICO II</h1>  </header></center>

* Profesor:  <a href="http://www.pucp.edu.pe/profesor/jose-manuel-magallanes/" target="_blank">Dr. José Manuel Magallanes, Ph.D.</a> <br>
    - Profesor del Departamento de Ciencias Sociales, Sección de Ciencia Política y Gobierno.
    - [Oficina 105](https://goo.gl/maps/xuGeG6o9di1i1y5m6) - Edificio CISEPA / ECONOMIA / CCSS
    - Telefono: (51) 1 - 6262000 anexo 4302
    - Correo Electrónico: [jmagallanes@pucp.edu.pe](mailto:jmagallanes@pucp.edu.pe)
    

____

<center> <header><h2>Preparación de Tabla de Datos</h2>  </header></center>
____

<a id='beginning'></a>

____





Reshaping

Aggregating




```{r, echo=FALSE, eval=FALSE}
library(htmltab) #activando (debe estar instalado)

url1 = "https://www.cia.gov/library/publications/resources/the-world-factbook/fields/211rank.html" 
gdp = htmltab(doc = url1, 
               which ='//*[@id="rankOrder"]',
               encoding = "UTF-8") 

names(gdp)[c(3,4)]=c('pbi','estimado')

library(readr) # activando
gdp[,c(3,4)]=lapply(gdp[,c(3,4)],parse_number)


url4 = "https://en.wikipedia.org/wiki/Democracy_Index"
demo<- htmltab(doc = url4, 
                  which ='//*[@id="mw-content-text"]/div/table[2]/tbody',encoding = "UTF-8")

library(stringr)
library(magrittr)
names(demo)=str_split(names(demo),">>",simplify = T)[,1]%>%gsub('\\s*','',.)

names(demo)[is.na(names(demo))]='Region'

linkPage='https://www.nationsonline.org/oneworld/corruption.htm'
linkTabla='/html/body/table[3]/tbody' # el XPATH
corruption = htmltab(doc = linkPage, 
               which =linkTabla) 

names(corruption)=gsub('\\s*','',names(corruption))



```
```{r, echo=FALSE, eval=FALSE}
write.csv(corruption,"data/corruption.csv",row.names = F)

write.csv(gdp,"data/gdp.csv",row.names = F)

write.csv(demo,"data/demo.csv",row.names = F)

```


## 1. Merging

Este proceso combina data frames con difente información, siempre que tengan un campo común, y este no se repita e ninguna otra columna. Traigamos tres data frames:

```{r}
library(rio)

base='https://github.com/PoliticayGobiernoPUCP/estadistica_anapol2/raw/master/DATA/'

corruptionLK=paste0(base,'corruption.csv')
gdpLK=paste0(base,'gdp.csv')
demoLK=paste0(base,'demo.csv')

corru=import(corruptionLK,stringsAsFactors = F)
gdp=import(gdpLK,stringsAsFactors = F)

democ=import(demoLK,stringsAsFactors = F)

```

Estos tres data frames deben tener un campo (columa) en común que sirva de **key**:

```{r}
names(corru)
names(gdp)
names(democ)
```

El merge producirá una tabla, integrando las columnas que correspondan a cada _key_. Vea que la columna _rank_ está presente en las tres pero no es la _key_; como el ranking se puede calcular si se necesitase, eliminemoslos de cada data frame:

```{r}
corru$Rank=NULL
gdp$Rank=NULL
democ$Rank=NULL
```

La columna _Score_ de la tabla _democ_ podriamos cambiar para no olvidar qué representa:

```{r}
names(democ)[names(democ)=='Score']='ScoreDemo'
```


Hay una column _Region_ en dos tablas:
```{r}
table(corru$Region)
```

```{r}
table(democ$Region)
```

Quedémonos con la de democracia:
```{r}
corru$Region=NULL
```



El _key_ es _Country_, usemoslo de manera explicita una vez

```{r}
corrgdp=merge(corru,gdp,by.x='Country', by.y='Country') # no era necesario KEY aqui!
corrgdpdemo=merge(corrgdp,democ)
```

Veamos:

```{r}
head(corrgdpdemo)
```

```{r}
tail(corrgdpdemo)
```



## 2. Formateo de Escala

```{r}
str(corrgdpdemo)
```

La _key_ debe quedar como texto ( _chr_ ), pero hay scores que deben pasar a numerico, otra a nominal y una a ordinal.

* a numerico...
```{r}
# 
corrgdpdemo[,c(2:6)]=lapply(corrgdpdemo[,c(2:6)],as.numeric)
```

* a nominal...

```{r}
# todo OK?
table(corrgdpdemo$Region)
```

```{r}
corrgdpdemo$Region=as.factor(corrgdpdemo$Region)
```


* a ordinal...

```{r}
# todo OK?
table(corrgdpdemo$Regimetype)
```

```{r}
library(dplyr)

corrgdpdemo$Regimetype= recode(corrgdpdemo$Regimetype,
       'Full democracy'='4FullDemocracy',
       'Flawed democracy'='3FlawedDemocracy',
       'Hybrid regime'='2Hybrid regime',
       'Authoritarian'='1Authoritarian')

# poner numero delante, ayuda a crear una ordinal
corrgdpdemo$Regimetype=as.ordered(corrgdpdemo$Regimetype)

```


Ahora está listo para los estadisticos:

```{r}
summary(corrgdpdemo)
```


## 3. Appending

Appending es unir diversas tablas en una, sólo que no añade columnas nuevas, sino que todas son iguales.




_____
<br></br>

[al INICIO](#beginning)

[VOLVER A CONTENIDOS](https://politicaygobiernopucp.github.io/estadistica_anapol2/)