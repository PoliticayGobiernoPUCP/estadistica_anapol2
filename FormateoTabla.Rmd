<center><img src="https://github.com/PoliticayGobiernoPUCP/estadistica_anapol2/raw/master/PICS/LOGO_PUCP.png" width="500"></center>

<center> <header><h1>ESTADISTICA PARA EL ANALISIS POLITICO II</h1>  </header></center>

* Profesor:  <a href="http://www.pucp.edu.pe/profesor/jose-manuel-magallanes/" target="_blank">Dr. José Manuel Magallanes, Ph.D.</a> <br>
    - Profesor del Departamento de Ciencias Sociales, Sección de Ciencia Política y Gobierno.
    - [Oficina 105](https://goo.gl/maps/xuGeG6o9di1i1y5m6) - Edificio CISEPA / ECONOMIA / CCSS
    - Telefono: (51) 1 - 6262000 anexo 4302
    - Correo Electrónico: [jmagallanes@pucp.edu.pe](mailto:jmagallanes@pucp.edu.pe)
    

____

<center> <header><h2>Preparación de Tabla de Datos</h2>  </header></center>
____

<a id='beginning'></a>

____

**Data 1: PBI per cápita** 

Cargamos datos: 

```{r}
library(htmltab) #activando (debe estar instalado)

url1 = "https://www.cia.gov/library/publications/resources/the-world-factbook/fields/211rank.html" 
gdp = htmltab(doc = url1, 
               which ='//*[@id="rankOrder"]',
               encoding = "UTF-8") 
```

Verificando estructura:
```{r}
str(gdp)
```


Notamos que la terceca y la cuarta columna tienen informacion numerica y de texto. Antes de hacer cambiamos, pongamosle nombres simples:


```{r}
names(gdp)[c(3,4)]=c('pbi','estimado')
```

Como sólo necesitamos un numero en cada columna:

```{r}
library(readr) # activando
gdp[,c(3,4)]=lapply(gdp[,c(3,4)],parse_number)
```

```{r}
head(gdp)
```




**Data 4: DEMOCRACY INDEX** 

Cargamos datos: 

```{r}
library(htmltab)
url4 = "https://en.wikipedia.org/wiki/Democracy_Index"
demo<- htmltab(doc = url4, 
                  which ='//*[@id="mw-content-text"]/div/table[2]/tbody',encoding = "UTF-8")

```

```{r}
str(demo)
```

Los nombres no ayudan:
```{r}
names(demo)
```

Veamos:
```{r}
library(stringr)
library(magrittr)
str_split(names(demo),">>",simplify = T)[,1]%>%   #divide
    gsub('\\s*','',.)                             #reemplaza TODO espacio
```

De ahí que:

```{r}
names(demo)=str_split(names(demo),">>",simplify = T)[,1]%>%gsub('\\s*','',.)
```

Recuerda que habiá un NA en los **nombres**. Completando el faltante:

```{r}
names(demo)[is.na(names(demo))]='Region'
```


Veamos nuevamente la estructura:

```{r}
str(demo)
```

Pasemos los valores numericos a su verdadero tipo
```{r}
demo[,c(3:8)]=lapply(demo[,c(3:8)], as.numeric)
```

Si cuando pasas valores a numérico R te dice que ha creado NAs, verifica qué pasó así:
```{r}
demo[!complete.cases(demo[,c(3:8)]),]
```


```{r}
# que valores tengo?
table(demo$Regimetype,exclude = 'nothing')
```

```{r}
#sale lo que quiero?

library(dplyr)
recode(demo$Regimetype,
       'Full democracy'='4FullDemocracy',
       'Flawed democracy'='3FlawedDemocracy',
       'Hybrid regime'='2Hybrid regime',
       'Authoritarian'='1Authoritarian')
```
```{r}
demo$Regimetype= recode(demo$Regimetype,
       'Full democracy'='4FullDemocracy',
       'Flawed democracy'='3FlawedDemocracy',
       'Hybrid regime'='2Hybrid regime',
       'Authoritarian'='1Authoritarian')
```

```{r}
# poner numero delante, ayuda a crear una ordinal
demo$Regimetype=as.ordered(demo$Regimetype)
```

```{r}
demo$Regimetype
```



```{r}
linkPage='https://www.nationsonline.org/oneworld/corruption.htm'
linkTabla='/html/body/table[3]/tbody' # el XPATH
corruption = htmltab(doc = linkPage, 
               which =linkTabla) 
```


```{r}
str(corruption)
```

reduzcamos nombres

```{r}
names(corruption)=gsub('\\s*','',names(corruption))
```

Pasemos a numérico:

```{r}
corruption[,c(3:7)]=lapply(corruption[,c(3:7)],as.numeric)
```

Notese que aquí se han producido errores, veamos en qué país fue:
```{r}
corruption[apply(is.na(corruption[,c(3:7)]), 1, all),]
```


Vemos que hay varios paises que no tenían valores, pero la fila _178_ no es un país. Así queda la data:
```{r}
corruption=corruption[!apply(is.na(corruption[,c(3:7)]), 1, all),]
```


Que tenemos:

```{r}
names(demo)
names(gdp)
names(corruption)
```
```{r}
demo$Rank=NULL
names(demo)[names(demo)=='Score']='ScoreDemo'
gdp$Rank=NULL
corruption$Rank=NULL

```



```{r}
str(gdp)
```

```{r}
str(demo)
```


```{r}
str(corruption)
```


```{r}
table(corruption$Region)
```

```{r}
table(demo$Region)
```


```{r}
demo$Region=NULL
```

```{r}
# merge no detallado, solo queda lo que coincida en ambas:
merge(corruption,demo,by.x = 'Country',by.y = 'Country')
```

```{r}
corrupdemo=merge(corruption,demo,by.x = 'Country',by.y = 'Country')
```


Y procedes con el merge:
```{r}
corrupdemogdp=merge(corrupdemo,gdp)
```

_____
<br></br>

[al INICIO](#beginning)

[VOLVER A CONTENIDOS](https://politicaygobiernopucp.github.io/estadistica_anapol2/)