<<center><img src="https://github.com/PoliticayGobiernoPUCP/estadistica_anapol2/raw/master/PICS/LOGO_PUCP.png" width="500"></center>

<center> <header><h1>ESTADISTICA PARA EL ANALISIS POLITICO II</h1>  </header></center>

* Profesor:  <a href="http://www.pucp.edu.pe/profesor/jose-manuel-magallanes/" target="_blank">Dr. José Manuel Magallanes, Ph.D.</a> <br>
    - Profesor del Departamento de Ciencias Sociales, Sección de Ciencia Política y Gobierno.
    - [Oficina 105](https://goo.gl/maps/xuGeG6o9di1i1y5m6) - Edificio CISEPA / ECONOMIA / CCSS
    - Telefono: (51) 1 - 6262000 anexo 4302
    - Correo Electrónico: [jmagallanes@pucp.edu.pe](mailto:jmagallanes@pucp.edu.pe)
    

____

<center> <header><h2>Leyendo Data desde R</h2>  </header></center>
____

<a id='beginning'></a>

El primer paso para realizar cualquier tipo de análisis es tener los datos. Esto condiciona además el diseño de la investigación. Revisaremos los siguientes casos:

1. [Propietary software.](#part1) 
2. [Uso de APIs.](#part3) 
3. ['Scraping' tablas de datos.](#part4) 
4. [Leyendo datos espaciales.](#part5) 

Los datos pueden estar en algun lugar de la web; si crees que esos datos permanecerán en ese sitio, quizás puedas sólo utilizar su link de descarga y leerlos directamente. Lo más seguro, en todo caso, es usarlos de esa manera y luego guardar esa data en tu **repositorio** del proyecto (en la 'nube'). Esto facilitará su lectura y **replicabilidad**. 

Si por alguna razón deseas leerlos desde tu computadora, debes tener los archivos en la misma carpeta de tu R Notebook.


____


<a id='part1'></a>

## Data de 'proprietary software'

* Leyendo STATA:

La encuesta LAPOP está en la web. Varios años son de libre acceso, pero podemos guardar una copia en GitHub, y leer esa copia desde ahí:
```{r, eval=FALSE}
library(rio)
lkDTA="https://github.com/PoliticayGobiernoPUCP/estadistica_anapol2/raw/master/DATA/lapop2012.dta"
dataStata=import(lkDTA)
```

Para verificar qué tenemos, podemos ver la ventana *Environment*, o pedir un reporte sencillo:

```{r}
dim(dataStata) #filas, columnas
```


Toda data debe tener una guía metodologica o una descripción de las columnas (_metadata_) en su web original. Es bueno copiar y mantener una copia de esos materiales en tu proyecto. 

La librería **rio** es muy versatil, y permite con el mismo comando **import()** abrir otros tipos de archivos, como veremos a continuación.

* Leyendo SPSS:

Abramos el mismo archivo de LAPOP, pero en SPSS:

```{r, eval=FALSE}
lkSAV="https://github.com/PoliticayGobiernoPUCP/estadistica_anapol2/raw/master/DATA/lapop2012.sav"
dataSpss=import(lkSAV)
```

Verificando:
```{r}
dim(dataSpss) #filas, columnas
```

* Leyendo Excel:

El mismo archivo, pero en EXCEL:

```{r, eval=FALSE}
lkXLSX="https://github.com/PoliticayGobiernoPUCP/estadistica_anapol2/raw/master/DATA/lapop2012.xlsx"
dataExcel=import(lkXLSX)
```

Verificando:

```{r}
dim(dataExcel) #filas, columnas
```

* Leyendo CSV:

Si la data está en CSV, podemos usar _rio_, y también la función del R básico:

```{r, eval=FALSE}

lkCSV="https://github.com/PoliticayGobiernoPUCP/estadistica_anapol2/raw/master/DATA/lapop2012.csv"
dataCSV=import(lkCSV)
```

Verificando:

```{r}
dim(dataCSV) #filas, columnas
```

* Archivos de GoogleDoc

Podemos muchas veces usar los formularios de Google Docs para recoger información. Estos formularios dejan la información en una hoja de calculo de google (GoogleSheet). Si Ud publica esa data como archiivo tipo CSV, use el comando anterior.


[al INICIO](#beginning)


-----

<a id='part3'></a>

## Uso de los APIs

Hay organizaciones que tiene una política de datos abiertos, por lo que ofrecen un portal ad-hoc para que se pueda acceder a sus datos. La data es recogida, por lo general, en formato  XML o JSON. 

Los API permiten construir pedidos de datos a través de una dirección web. Para que el trabajo de colección de datos sea exitoso, necesitamos revisar la documentación del API.

Por ejemplo, la Municipalidad de San Isidro tiene un [portal de datos abiertos](http://datosabiertos.msi.gob.pe/home). En este caso accederemos a los datos de Seguridad Ciudadana, siguiendo el [link](http://datosabiertos.msi.gob.pe/dashboards/9238/seguridad-ciudadana-y-fiscalizacion/) ofrecido en el portal. Cuando se accede, se ven dos tablas de datos; si selecciona *intervenciones de serenazgo* verá sólo esa tabla.

A la izquierda hay unos íconos:

Traigamos la data producida por el servicio '9-1-1' de la Policia de Seattle, Washington:
```{r, eval=FALSE}

key='e309f64f37e50c0893da23a36d9165f0fd182e39&from=01/01/2016'

#install.packages("jsonlite")
library(jsonlite) 
base="http://api.datosabiertos.msi.gob.pe/api/v2/datastreams/INTER-DE-SEREN-2019/data.pjson/?auth_key=" 
endPoint=paste0(base,key)
data911 = fromJSON(endPoint)
as.data.frame(data911$result)
```

[Go to page beginning](#beginning)

----


<a id='part4'></a>


##‘Scraping’ tablas de datos

Aqui descargaremos los datos de esta [wikipage](https://en.wikipedia.org/wiki/List_of_freedom_indices)

```{r, eval=FALSE}
# Install: XML, RCurl
# Activate
library(XML)
library(RCurl)

# URL
wiki="https://en.wikipedia.org/wiki/" 
link = "List_of_freedom_indices" 

# Data
wikiLinkContents = getURL(paste0(wiki,link)) 
wikiTables = readHTMLTable(wikiLinkContents,
                           stringsAsFactors=FALSE)
```

Vemos que tenemos:
    
```{r, eval=FALSE}
#data frame:
is.data.frame(wikiTables)
#list:
is.list(wikiTables)
# how many?
length(wikiTables)
```

Al visitar la web, nos damos cuenta la tabla de interés es la segunda:
```{r, eval=FALSE}
idx=wikiTables[[2]]
str(idx)
```
  
Una breve mirada:
```{r, eval=FALSE}
head(idx)
```
  
[Go to page beginning](#beginning)

----

<a id='part5'></a>

## Recolectando Datos espaciales

Los datos especiales presentan una complejidad diferente. Este tipo de datos, además de la información de la unidad de estudio, guardan información que permite visualizar lineas, puntos y poligonos.

El formato RDS de R puede almacenar este tipo de información. Por ejemplo, si visitas la pagina web del [GADM database of Global Administrative Areas](http://www.gadm.org/country) puedes descargar mapas por país a diversos niveles subnacionales. Si visitas el link y buscas Perú puedes hacer:

```{r, eval=FALSE}
library(sp) 
PeruRegs <- readRDS(gzcon(url("http://biogeo.ucdavis.edu/data/gadm2.8/rds/PER_adm1.rds")))
```

PeruRegs ya tiene la información. Si solo quieres ver los datos de cada unidad debes hacer:

```{r, eval=FALSE}
PeruRegs@data
```
Aqui grafico:
```{r, eval=FALSE}
plot(PeruRegs)
```

Un formato más común son los mapas en SHAPEFILE. Hay un directorio dentro del folder _data_ donde estan varios mapas de limites administrativos del Perú:
```{r, eval=FALSE}
folderMap='PER_adm_shp'
fileName='PER_adm1.shp' # nivel 1 son regiones
fileToRead=file.path(folder,folderMap,fileName)

library(maptools)
library(rgeos)
PeruRegs_shp=readShapePoly(fileToRead)
```

*PeruRegs_shp* tiene el mapa, pero salió un _warning_ que podemos obviar. El gráfico aún funciona:
```{r, eval=FALSE}
plot(PeruRegs_shp)
```

Si hacemos caso al _warning_ anterior: 
```{r, eval=FALSE}
library(rgdal)
library(sf)
PeruRegs_shp <- rgdal::readOGR(fileToRead)

```

Sin problema, el mapa se dibujará.
```{r, eval=FALSE}
plot(PeruRegs_shp)
```

_____
<br></br>

####[VOLVER AL SILABO](https://politicaygobiernopucp.github.io/EstadisticaPoliticaGobiernoII/)